"use strict";(self.webpackChunk_aws_threat_composer=self.webpackChunk_aws_threat_composer||[]).push([[3537],{"./src/components/generic/FileUpload/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>generic_FileUpload});var components_button=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),form_field=__webpack_require__("../../node_modules/@cloudscape-design/components/form-field/index.js"),space_between=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),react=__webpack_require__("../../node_modules/react/index.js"),status_indicator=__webpack_require__("../../node_modules/@cloudscape-design/components/status-indicator/index.js"),text_content=__webpack_require__("../../node_modules/@cloudscape-design/components/text-content/index.js");const utils_getDisplayLastModified=lastModified=>`Last modified: ${new Date(lastModified).toLocaleString()}`,utils_getDisplaySize=size=>{if(!size)return;const i=Math.floor(Math.log(size)/Math.log(1e3));return`Size: ${parseFloat((size/Math.pow(1e3,i)).toFixed(2))} ${["bytes","KB","MB","GB"][i]}`};var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const FileTokenLabel=({name,size,lastModified})=>(0,jsx_runtime.jsxs)(space_between.Z,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(status_indicator.Z,{type:"success"}),(0,jsx_runtime.jsx)(text_content.Z,{children:(0,jsx_runtime.jsxs)(space_between.Z,{direction:"vertical",size:"xxxs",children:[(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("b",{children:name})},"name"),(0,jsx_runtime.jsx)("span",{children:utils_getDisplaySize(size)},"size"),lastModified&&(0,jsx_runtime.jsx)("span",{children:utils_getDisplayLastModified(lastModified)},"lastModified")]})})]});FileTokenLabel.displayName="FileTokenLabel";const components_FileTokenLabel=FileTokenLabel;try{FileTokenLabel.displayName="FileTokenLabel",FileTokenLabel.__docgenInfo={description:"",displayName:"FileTokenLabel",props:{name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"number"}},lastModified:{defaultValue:null,description:"",name:"lastModified",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/FileUpload/components/FileTokenLabel/index.tsx#FileTokenLabel"]={docgenInfo:FileTokenLabel.__docgenInfo,name:"FileTokenLabel",path:"src/components/generic/FileUpload/components/FileTokenLabel/index.tsx#FileTokenLabel"})}catch(__react_docgen_typescript_loader_error){}const FileUpload=({controlId,label,description,constraintText,secondaryControl,errorText,info,buttonText="Choose file",name,accept,files,onChange,...props})=>{const inputElement=(0,react.useRef)(null),footer=(0,react.useMemo)((()=>files&&0!==files.length?(0,jsx_runtime.jsx)(components_FileTokenLabel,{name:files[0].name,lastModified:files[0].lastModified,size:files[0].size}):null),[files]),handleFileSelectionButtonClick=(0,react.useCallback)((()=>{inputElement.current?.click()}),[]),handleFileSelectionChange=(0,react.useCallback)((event=>{const newFiles=[];if(event.target.files){const targetFiles=event.target.files,len=targetFiles.length;for(let i=0;i<len;i++){const file=targetFiles.item(i);file&&newFiles.push(file)}}onChange?.(newFiles)}),[files,onChange]);return(0,jsx_runtime.jsxs)(space_between.Z,{direction:"vertical",size:"m",children:[(0,jsx_runtime.jsxs)(form_field.Z,{...props,label,info,description,constraintText,secondaryControl,errorText,children:[(0,jsx_runtime.jsx)("input",{ref:inputElement,name,style:{display:"none"},type:"file",accept,onChange:handleFileSelectionChange}),(0,jsx_runtime.jsx)(components_button.Z,{iconName:"upload",onClick:handleFileSelectionButtonClick,children:buttonText})]}),footer]})};FileUpload.displayName="FileUpload";const generic_FileUpload=FileUpload;try{FileUpload.displayName="FileUpload",FileUpload.__docgenInfo={description:"",displayName:"FileUpload",props:{accept:{defaultValue:null,description:"",name:"accept",required:!1,type:{name:"string"}},buttonText:{defaultValue:{value:"Choose file"},description:"",name:"buttonText",required:!1,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((files: File[]) => void)"}},files:{defaultValue:null,description:"",name:"files",required:!1,type:{name:"File[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/FileUpload/index.tsx#FileUpload"]={docgenInfo:FileUpload.__docgenInfo,name:"FileUpload",path:"src/components/generic/FileUpload/index.tsx#FileUpload"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/workspaces/WorkspaceSelector/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>workspaces_WorkspaceSelector});var DeleteConfirmationDialog=__webpack_require__("../../node_modules/@aws-northstar/ui/components/DeleteConfirmationDialog/index.js"),components_alert=__webpack_require__("../../node_modules/@cloudscape-design/components/alert/index.js"),components_button=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),button_dropdown=__webpack_require__("../../node_modules/@cloudscape-design/components/button-dropdown/index.js"),components_select=__webpack_require__("../../node_modules/@cloudscape-design/components/select/index.js"),space_between=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),react=__webpack_require__("../../node_modules/react/index.js"),constants=__webpack_require__("./src/configs/constants.ts"),GlobalSetupContext=__webpack_require__("./src/contexts/GlobalSetupContext/index.tsx"),WorkspaceExamplesContext=__webpack_require__("./src/contexts/WorkspaceExamplesContext/index.tsx"),WorkspacesContext=__webpack_require__("./src/contexts/WorkspacesContext/index.tsx"),useExportImport=__webpack_require__("./src/hooks/useExportImport/index.ts"),contexts=__webpack_require__("./src/contexts/index.ts"),ApplicationContext=__webpack_require__("./src/contexts/ApplicationContext/index.tsx"),ArchitectureContext=__webpack_require__("./src/contexts/ArchitectureContext/index.tsx"),AssumptionLinksContext=__webpack_require__("./src/contexts/AssumptionLinksContext/index.tsx"),AssumptionsContext=__webpack_require__("./src/contexts/AssumptionsContext/index.tsx"),DataflowContext=__webpack_require__("./src/contexts/DataflowContext/index.tsx"),MitigationLinksContext=__webpack_require__("./src/contexts/MitigationLinksContext/index.tsx"),MitigationsContext=__webpack_require__("./src/contexts/MitigationsContext/index.tsx"),ThreatsContext=__webpack_require__("./src/contexts/ThreatsContext/index.tsx");const hooks_useRemoveData=()=>{const{composerMode}=(0,GlobalSetupContext.n)(),{removeWorkspace,switchWorkspace}=(0,contexts.$C)(),{removeApplicationInfo,onDeleteWorkspace:applicationInfoDeleteWorkspace}=(0,ApplicationContext.M)(),{removeArchitectureInfo,onDeleteWorkspace:architectureInfoDeleteWorkspace}=(0,ArchitectureContext.P)(),{removeDataflowInfo,onDeleteWorkspace:dataflowInfoDeleteWorkspace}=(0,DataflowContext.y)(),{removeAllAssumptions,onDeleteWorkspace:assumptionsDeleteWorkspace}=(0,AssumptionsContext.H)(),{removeAllMitigations,onDeleteWorkspace:mitigationsDeleteWorkspace}=(0,MitigationsContext.I)(),{removeAllStatements,onDeleteWorkspace:threatsDeleteWorkspace}=(0,ThreatsContext.a)(),{removeAllAssumptionLinks,onDeleteWorkspace:assumptionLinksDeleteWorkspace}=(0,AssumptionLinksContext._)(),{removeAllMitigationLinks,onDeleteWorkspace:mitigationLinksDeleteWorkspace}=(0,MitigationLinksContext.e)();return{removeData:(0,react.useCallback)((async()=>"Full"===composerMode?Promise.all([removeApplicationInfo(),removeArchitectureInfo(),removeDataflowInfo(),removeAllAssumptions(),removeAllMitigations(),removeAllStatements(),removeAllAssumptionLinks(),removeAllMitigationLinks()]):removeAllStatements()),[composerMode,removeApplicationInfo,removeArchitectureInfo,removeDataflowInfo,removeAllAssumptions,removeAllMitigations,removeAllStatements,removeAllAssumptionLinks,removeAllMitigationLinks]),deleteCurrentWorkspace:(0,react.useCallback)((async toDeleteWorkspaceId=>{toDeleteWorkspaceId&&(await Promise.all([removeWorkspace(toDeleteWorkspaceId),applicationInfoDeleteWorkspace(toDeleteWorkspaceId),architectureInfoDeleteWorkspace(toDeleteWorkspaceId),threatsDeleteWorkspace(toDeleteWorkspaceId),dataflowInfoDeleteWorkspace(toDeleteWorkspaceId),assumptionsDeleteWorkspace(toDeleteWorkspaceId),mitigationsDeleteWorkspace(toDeleteWorkspaceId),assumptionLinksDeleteWorkspace(toDeleteWorkspaceId),mitigationLinksDeleteWorkspace(toDeleteWorkspaceId)]),switchWorkspace(null))}),[composerMode,switchWorkspace,applicationInfoDeleteWorkspace,architectureInfoDeleteWorkspace,dataflowInfoDeleteWorkspace,threatsDeleteWorkspace,assumptionsDeleteWorkspace,mitigationsDeleteWorkspace,assumptionLinksDeleteWorkspace,mitigationLinksDeleteWorkspace])}};var isWorkspaceExample=__webpack_require__("./src/utils/isWorkspaceExample/index.ts"),box=__webpack_require__("../../node_modules/@cloudscape-design/components/box/index.js"),form_field=__webpack_require__("../../node_modules/@cloudscape-design/components/form-field/index.js"),header=__webpack_require__("../../node_modules/@cloudscape-design/components/header/index.js"),modal=__webpack_require__("../../node_modules/@cloudscape-design/components/modal/index.js"),customTypes=__webpack_require__("./src/customTypes/index.ts"),Input=__webpack_require__("./src/components/generic/Input/index.tsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const EditWorkspace=({visible,setVisible,onConfirm,editMode=!1,...props})=>{const inputRef=(0,react.useRef)(),[value,setValue]=(0,react.useState)(props.value||""),handleConfirm=(0,react.useCallback)((()=>{onConfirm(value),setVisible(!1)}),[onConfirm,value]);(0,react.useEffect)((()=>{inputRef.current?.focus()}),[inputRef.current]);const footer=(0,react.useMemo)((()=>(0,jsx_runtime.jsx)(box.Z,{float:"right",children:(0,jsx_runtime.jsxs)(space_between.Z,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(components_button.Z,{variant:"link",onClick:()=>setVisible(!1),children:"Cancel"}),(0,jsx_runtime.jsx)(components_button.Z,{variant:"primary",disabled:value.length<3,onClick:handleConfirm,children:editMode?"Update":"Add"})]})})),[setVisible,handleConfirm,value,editMode]);return(0,jsx_runtime.jsx)(modal.Z,{header:(0,jsx_runtime.jsx)(header.Z,{children:editMode?"Update workspace":"Add new workspace"}),visible,footer,onDismiss:()=>setVisible(!1),children:(0,jsx_runtime.jsx)(space_between.Z,{direction:"vertical",size:"m",children:(0,jsx_runtime.jsx)(form_field.Z,{label:"Workspace name",children:(0,jsx_runtime.jsx)(Input.Z,{ref:inputRef,value,onChange:({detail})=>setValue(detail.value),validateData:customTypes.WorkspaceSchema.shape.name.safeParse})})})})};EditWorkspace.displayName="EditWorkspace";const workspaces_EditWorkspace=EditWorkspace;try{EditWorkspace.displayName="EditWorkspace",EditWorkspace.__docgenInfo={description:"",displayName:"EditWorkspace",props:{visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},setVisible:{defaultValue:null,description:"",name:"setVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"(workspace: string) => void"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string"}},editMode:{defaultValue:{value:"false"},description:"",name:"editMode",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/workspaces/EditWorkspace/index.tsx#EditWorkspace"]={docgenInfo:EditWorkspace.__docgenInfo,name:"EditWorkspace",path:"src/components/workspaces/EditWorkspace/index.tsx#EditWorkspace"})}catch(__react_docgen_typescript_loader_error){}var progress_bar=__webpack_require__("../../node_modules/@cloudscape-design/components/progress-bar/index.js"),text_content=__webpack_require__("../../node_modules/@cloudscape-design/components/text-content/index.js"),FileUpload=__webpack_require__("./src/components/generic/FileUpload/index.tsx");const FileImport=({composerMode,visible,setVisible,onImport,onExport,onPreview,onPreviewClose})=>{const[selectedFiles,setSelectedFiles]=(0,react.useState)([]),[data,setData]=(0,react.useState)(),[error,setError]=(0,react.useState)(),[loading,setLoading]=(0,react.useState)(!1),[loadingPercentage,setLoadingPercentage]=(0,react.useState)(0),{parseImportedData}=(0,useExportImport.Z)(),handleImport=(0,react.useCallback)((files=>{if(setError(""),setData(void 0),setLoading(!0),files.length>0){const file=files[0],reader=new FileReader;reader.addEventListener("load",(event=>{const result=event.target?.result;setError("");try{const importedData=parseImportedData(JSON.parse(result));setData(importedData)}catch(e){setError(e.message)}finally{setLoading(!1)}})),reader.addEventListener("progress",(event=>{if(event.loaded&&event.total){const percent=event.loaded/event.total*100;setLoadingPercentage(percent)}})),reader.readAsText(file)}}),[]),handleConfirmImport=(0,react.useCallback)((()=>{data&&onImport(data),setSelectedFiles([]),setVisible(!1),onPreviewClose?.()}),[onImport,data,onPreviewClose]);(0,react.useEffect)((()=>{selectedFiles&&selectedFiles.length>0&&handleImport(selectedFiles)}),[selectedFiles]);const handlePreview=(0,react.useCallback)((()=>{data&&onPreview?.(data)}),[data]),footer=(0,react.useMemo)((()=>(0,jsx_runtime.jsx)(box.Z,{float:"right",children:(0,jsx_runtime.jsxs)(space_between.Z,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(components_button.Z,{variant:"link",onClick:()=>{setVisible(!1),onPreviewClose?.()},children:"Cancel"}),onPreview&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:handlePreview,disabled:!data,children:"Preview"}),(0,jsx_runtime.jsx)(components_button.Z,{variant:"primary",disabled:!data,onClick:()=>handleConfirmImport(),children:"Import"})]})})),[setVisible,handleConfirmImport,onPreview,onPreviewClose]);return(0,jsx_runtime.jsx)(modal.Z,{visible,footer,onDismiss:()=>{setVisible(!1),onPreviewClose?.()},children:(0,jsx_runtime.jsxs)(space_between.Z,{direction:"vertical",size:"m",children:[(0,jsx_runtime.jsx)(components_alert.Z,{action:(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>onExport(),children:"Export data"}),statusIconAriaLabel:"Warning",type:"warning",children:(0,jsx_runtime.jsxs)(text_content.Z,{children:["Importing data will override all the data in current workspace. This action cannot be undone.",(0,jsx_runtime.jsx)("br",{}),"You can export the data to a json file as backup or create a new ",(0,jsx_runtime.jsx)("b",{children:"workspace"}),"."]})},"override-warning"),(0,jsx_runtime.jsx)(components_alert.Z,{statusIconAriaLabel:"Warning",type:"warning",children:(0,jsx_runtime.jsx)(text_content.Z,{children:"Only import content from trusted sources."})},"content-warning"),(0,jsx_runtime.jsx)(FileUpload.Z,{accept:"application/json",files:selectedFiles,onChange:setSelectedFiles},"fileUpload"),loading&&(0,jsx_runtime.jsx)(progress_bar.Z,{value:loadingPercentage,label:"Loading file"},"progress-bar"),error&&(0,jsx_runtime.jsx)(components_alert.Z,{statusIconAriaLabel:"Error",type:"error",children:error},"error"),!onPreview&&"Full"!==composerMode&&data&&data.threats&&data.threats.length>0&&(0,jsx_runtime.jsxs)(components_alert.Z,{statusIconAriaLabel:"Info",type:"info",children:[data.threats.length," threat statement loaded"]},"info")]})})};FileImport.displayName="FileImport";const workspaces_FileImport=FileImport;try{FileImport.displayName="FileImport",FileImport.__docgenInfo={description:"",displayName:"FileImport",props:{composerMode:{defaultValue:null,description:"",name:"composerMode",required:!0,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},setVisible:{defaultValue:null,description:"",name:"setVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}},onImport:{defaultValue:null,description:"",name:"onImport",required:!0,type:{name:"(data: { schema: number; workspace?: { name: string; id: string; } | undefined; applicationInfo?: { name?: string | undefined; description?: string | undefined; } | undefined; architecture?: { ...; } | undefined; ... 5 more ...; threats?: { ...; }[] | undefined; }) => void"}},onExport:{defaultValue:null,description:"",name:"onExport",required:!0,type:{name:"() => void"}},onPreview:{defaultValue:null,description:"",name:"onPreview",required:!1,type:{name:"((data: { schema: number; workspace?: { name: string; id: string; }; applicationInfo?: { name?: string; description?: string | undefined; } | undefined; architecture?: { ...; } | undefined; ... 5 more ...; threats?: { ...; }[] | undefined; }) => void) | undefined"}},onPreviewClose:{defaultValue:null,description:"",name:"onPreviewClose",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/workspaces/FileImport/index.tsx#FileImport"]={docgenInfo:FileImport.__docgenInfo,name:"FileImport",path:"src/components/workspaces/FileImport/index.tsx#FileImport"})}catch(__react_docgen_typescript_loader_error){}const WorkspaceSelector=({embededMode=!0,children,enabledExportAll,enabledExportFiltered,enabledRemoveAll,filteredThreats})=>{const[addWorkspaceModalVisible,setAddWorkspaceModalVisible]=(0,react.useState)(!1),[editWorkspaceModalVisible,setEditWorkspaceModalVisible]=(0,react.useState)(!1),[removeDataModalVisible,setRemoveDataModalVisible]=(0,react.useState)(!1),[removeWorkspaceModalVisible,setRemoveWorkspaceModalVisible]=(0,react.useState)(!1),[isRemovingWorkspace,setIsRemovingWorkspace]=(0,react.useState)(!1),{workspaceExamples}=(0,WorkspaceExamplesContext.l)(),{importData,exportAll,exportSelectedThreats}=(0,useExportImport.Z)(),{removeData,deleteCurrentWorkspace}=hooks_useRemoveData(),{composerMode,onPreview,onPreviewClose,onImported,fileImportModalVisible,setFileImportModalVisible}=(0,GlobalSetupContext.n)(),{currentWorkspace,workspaceList,addWorkspace,renameWorkspace,switchWorkspace}=(0,WorkspacesContext.$)(),workspacesOptions=(0,react.useMemo)((()=>{const options=[{label:constants.VN,value:constants.Ac},{label:constants.tb,options:workspaceExamples.map((we=>({label:we.name,value:we.id})))}];return workspaceList&&workspaceList.length>0&&options.push({label:"Workspaces",options:workspaceList.map((w=>({label:w.name,value:w.id})))}),options}),[workspaceList]),handleSelectWorkspace=(0,react.useCallback)((({detail})=>{const selectedItem=detail.selectedOption;selectedItem.value===constants.Ac?switchWorkspace(null):selectedItem.value&&selectedItem.label&&switchWorkspace({id:selectedItem.value,name:selectedItem.label})}),[switchWorkspace]),handleMoreActions=(0,react.useCallback)((async({detail})=>{switch(detail.id){case"add":setAddWorkspaceModalVisible(!0);break;case"import":setFileImportModalVisible(!0);break;case"exportAll":exportAll();break;case"exportFilteredList":exportSelectedThreats(filteredThreats||[]);break;case"removeAll":setRemoveDataModalVisible(!0);break;case"delete":currentWorkspace&&setRemoveWorkspaceModalVisible(!0);break;case"renameWorkspace":setEditWorkspaceModalVisible(!0);break;default:console.log("Unknown action",detail.id)}}),[setFileImportModalVisible,exportAll,exportSelectedThreats,filteredThreats,deleteCurrentWorkspace,currentWorkspace,setRemoveDataModalVisible,setRemoveWorkspaceModalVisible,setAddWorkspaceModalVisible]),handleRemoveData=(0,react.useCallback)((async()=>{try{await(removeData?.())}catch(e){console.log("Error in removing data from workspace",e)}finally{setRemoveDataModalVisible(!1)}}),[removeData]),handleDeleteWorkspace=(0,react.useCallback)((async toDeleteWorkspaceId=>{setIsRemovingWorkspace(!0);try{await deleteCurrentWorkspace(toDeleteWorkspaceId)}catch(e){console.log("Error in deleting workspace",e)}finally{setRemoveWorkspaceModalVisible(!1),setIsRemovingWorkspace(!1)}}),[]),handleImport=(0,react.useCallback)((data=>{importData(data),onImported?.()}),[importData,onImported]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(space_between.Z,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(components_select.Z,{controlId:"WorkspacesSelect",selectedOption:{value:currentWorkspace?.id||constants.Ac,label:`Workspace: ${currentWorkspace?.name||constants.VN}`},options:workspacesOptions,onChange:handleSelectWorkspace}),children,(0,jsx_runtime.jsx)(button_dropdown.Z,{items:[{id:"add",text:"Add new workspace"},{id:"import",text:"Import",disabled:(0,isWorkspaceExample.Z)(currentWorkspace?.id)},{id:"exportAll",text:embededMode?"Export all statements from current workspace":"Export data from current workspace",disabled:embededMode&&!enabledExportAll},...embededMode?[{id:"exportFilteredList",text:"Export filtered statement list from current workspace",disabled:!enabledExportFiltered}]:[],{id:"removeAll",text:embededMode?"Remove all statements from current workspace":"Remove data from current workspace",disabled:embededMode&&!enabledRemoveAll||(0,isWorkspaceExample.Z)(currentWorkspace?.id)},{id:"delete",text:"Delete workspace",disabled:!currentWorkspace||(0,isWorkspaceExample.Z)(currentWorkspace.id)},{id:"renameWorkspace",text:"Rename workspace",disabled:!currentWorkspace||(0,isWorkspaceExample.Z)(currentWorkspace.id)}],ariaLabel:"More actions",variant:"icon",onItemClick:handleMoreActions})]}),fileImportModalVisible&&(0,jsx_runtime.jsx)(workspaces_FileImport,{composerMode,visible:fileImportModalVisible,setVisible:setFileImportModalVisible,onExport:exportAll,onImport:handleImport,onPreview,onPreviewClose}),addWorkspaceModalVisible&&(0,jsx_runtime.jsx)(workspaces_EditWorkspace,{visible:addWorkspaceModalVisible,setVisible:setAddWorkspaceModalVisible,onConfirm:addWorkspace}),editWorkspaceModalVisible&&currentWorkspace&&(0,jsx_runtime.jsx)(workspaces_EditWorkspace,{visible:editWorkspaceModalVisible,setVisible:setEditWorkspaceModalVisible,editMode:!0,value:currentWorkspace.name,onConfirm:newWorkspaceName=>renameWorkspace(currentWorkspace.id,newWorkspaceName)}),removeDataModalVisible&&(0,jsx_runtime.jsx)(DeleteConfirmationDialog.Z,{variant:"friction",visible:removeDataModalVisible,title:"Delete data from current workspace?",onCancelClicked:()=>setRemoveDataModalVisible(!1),onDeleteClicked:handleRemoveData,deleteButtonText:"Remove data",children:(0,jsx_runtime.jsxs)(components_alert.Z,{action:(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>exportAll(),children:"Export data"}),type:"warning",children:["Delete ",(0,jsx_runtime.jsxs)("b",{children:["Data from ",currentWorkspace?`workspace ${currentWorkspace.name}`:"Default workspace"]})," permenantly? This action cannot be undone.",(0,jsx_runtime.jsx)("br",{}),"You can export the data to a json file as backup."]})}),removeWorkspaceModalVisible&&currentWorkspace&&(0,jsx_runtime.jsx)(DeleteConfirmationDialog.Z,{variant:"friction",visible:removeWorkspaceModalVisible,title:"Delete Workspace?",onCancelClicked:()=>setRemoveWorkspaceModalVisible(!1),onDeleteClicked:()=>handleDeleteWorkspace(currentWorkspace.id),loading:isRemovingWorkspace,deleteButtonText:"Delete workspace",children:(0,jsx_runtime.jsxs)(components_alert.Z,{action:(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>exportAll(),children:"Export data"}),type:"warning",children:["Delete ",(0,jsx_runtime.jsxs)("b",{children:["workspace ",currentWorkspace?.name]})," permenantly? All the data inside workspace will be deleted. This action cannot be undone.",(0,jsx_runtime.jsx)("br",{}),"You can export the data to a json file as backup."]})})]})},workspaces_WorkspaceSelector=WorkspaceSelector;try{WorkspaceSelector.displayName="WorkspaceSelector",WorkspaceSelector.__docgenInfo={description:"",displayName:"WorkspaceSelector",props:{embededMode:{defaultValue:{value:"true"},description:"",name:"embededMode",required:!1,type:{name:"boolean"}},enabledExportAll:{defaultValue:null,description:"",name:"enabledExportAll",required:!1,type:{name:"boolean"}},enabledRemoveAll:{defaultValue:null,description:"",name:"enabledRemoveAll",required:!1,type:{name:"boolean"}},enabledExportFiltered:{defaultValue:null,description:"",name:"enabledExportFiltered",required:!1,type:{name:"boolean"}},filteredThreats:{defaultValue:null,description:"",name:"filteredThreats",required:!1,type:{name:"{ id: string; numericId: number; tags?: string[]; displayOrder?: number; metadata?: { value: (string | string[]) & (string | string[] | undefined); key: string; }[] | undefined; ... 8 more ...; displayedStatement?: (string | { ...; })[] | undefined; }[] | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/workspaces/WorkspaceSelector/index.tsx#WorkspaceSelector"]={docgenInfo:WorkspaceSelector.__docgenInfo,name:"WorkspaceSelector",path:"src/components/workspaces/WorkspaceSelector/index.tsx#WorkspaceSelector"})}catch(__react_docgen_typescript_loader_error){}},"./src/contexts/ContextAggregator/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _GlobalSetupContext__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/contexts/GlobalSetupContext/index.tsx"),_WorkspaceContextAggregator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/contexts/WorkspaceContextAggregator/index.tsx"),_WorkspacesContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/contexts/WorkspacesContext/index.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/react/jsx-runtime.js");const ContextAggregator=({children,onWorkspaceChanged,composerMode="Full",features,onPreview,onPreviewClose,onImported,onDefineWorkload,...props})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_GlobalSetupContext__WEBPACK_IMPORTED_MODULE_0__.Z,{onPreview,onPreviewClose,onImported,features,onDefineWorkload,composerMode,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_WorkspacesContext__WEBPACK_IMPORTED_MODULE_2__.Z,{onWorkspaceChanged,...props,children:workspaceId=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_WorkspaceContextAggregator__WEBPACK_IMPORTED_MODULE_1__.Z,{workspaceId,requiredGlobalSetupContext:!1,onThreatEditorView:props.onThreatEditorView,onThreatListView:props.onThreatListView,children})})});ContextAggregator.displayName="ContextAggregator";const __WEBPACK_DEFAULT_EXPORT__=ContextAggregator;try{ContextAggregator.displayName="ContextAggregator",ContextAggregator.__docgenInfo={description:"",displayName:"ContextAggregator",props:{composerMode:{defaultValue:{value:"Full"},description:"",name:"composerMode",required:!1,type:{name:"enum",value:[{value:'"ThreatsOnly"'},{value:'"EditorOnly"'},{value:'"Full"'}]}},features:{defaultValue:null,description:"",name:"features",required:!1,type:{name:"string[]"}},onWorkspaceChanged:{defaultValue:null,description:"",name:"onWorkspaceChanged",required:!1,type:{name:"((workspaceId: string) => void)"}},onPreview:{defaultValue:null,description:"",name:"onPreview",required:!1,type:{name:"((content: { schema: number; workspace?: { name: string; id: string; }; applicationInfo?: { name?: string; description?: string | undefined; } | undefined; architecture?: { ...; } | undefined; ... 5 more ...; threats?: { ...; }[] | undefined; }) => void) | undefined"}},onPreviewClose:{defaultValue:null,description:"",name:"onPreviewClose",required:!1,type:{name:"(() => void)"}},onImported:{defaultValue:null,description:"",name:"onImported",required:!1,type:{name:"(() => void)"}},onDefineWorkload:{defaultValue:null,description:"",name:"onDefineWorkload",required:!1,type:{name:"(() => void)"}},onApplicationInfoView:{defaultValue:null,description:"",name:"onApplicationInfoView",required:!1,type:{name:"(() => void)"}},onArchitectureView:{defaultValue:null,description:"",name:"onArchitectureView",required:!1,type:{name:"(() => void)"}},onDataflowView:{defaultValue:null,description:"",name:"onDataflowView",required:!1,type:{name:"(() => void)"}},onAssumptionListView:{defaultValue:null,description:"",name:"onAssumptionListView",required:!1,type:{name:"(() => void)"}},onMitigationListView:{defaultValue:null,description:"",name:"onMitigationListView",required:!1,type:{name:"(() => void)"}},onThreatListView:{defaultValue:null,description:"",name:"onThreatListView",required:!1,type:{name:"((filter?: ThreatStatementListFilter) => void)"}},onThreatEditorView:{defaultValue:null,description:"",name:"onThreatEditorView",required:!1,type:{name:"((threatId: string) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/contexts/ContextAggregator/index.tsx#ContextAggregator"]={docgenInfo:ContextAggregator.__docgenInfo,name:"ContextAggregator",path:"src/contexts/ContextAggregator/index.tsx#ContextAggregator"})}catch(__react_docgen_typescript_loader_error){}},"./src/contexts/WorkspacesContext/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>contexts_WorkspacesContext,$:()=>context.$});var react=__webpack_require__("../../node_modules/react/index.js"),es=__webpack_require__("../../node_modules/use-local-storage-state/es/index.js"),v4=__webpack_require__("../../node_modules/uuid/dist/esm-browser/v4.js"),context=__webpack_require__("./src/contexts/WorkspacesContext/context.ts"),constants=__webpack_require__("./src/configs/constants.ts"),localStorageKeys=__webpack_require__("./src/configs/localStorageKeys.ts"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const WorkspacesMigration=({children})=>{const{workspaceList,setWorkspaceList}=(0,context.$)(),[migrated,setMigrated]=(0,es.Z)(localStorageKeys.bd,{defaultValue:!1});return(0,react.useEffect)((()=>{migrated||(workspaceList.length>0&&"string"==typeof workspaceList[0]&&setWorkspaceList((prev=>{const newList=prev.map((p=>({id:(0,v4.Z)(),name:p})));return currentWorkspace&&"string"==typeof currentWorkspace&&setCurrentWorkspace((prevWs=>newList.find((x=>x.name===prevWs)))),newList})),setMigrated(!0))}),[workspaceList,migrated]),migrated&&children?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children}):null},migrations_WorkspacesMigration=WorkspacesMigration;try{WorkspacesMigration.displayName="WorkspacesMigration",WorkspacesMigration.__docgenInfo={description:"Migrates the old workspaces list to the new format",displayName:"WorkspacesMigration",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/migrations/WorkspacesMigration/index.tsx#WorkspacesMigration"]={docgenInfo:WorkspacesMigration.__docgenInfo,name:"WorkspacesMigration",path:"src/migrations/WorkspacesMigration/index.tsx#WorkspacesMigration"})}catch(__react_docgen_typescript_loader_error){}const WorkspacesContextProvider=({children,workspaceId,onWorkspaceChanged,...props})=>{const[currentWorkspace,setCurrentWorkspace]=(0,es.Z)(localStorageKeys.fY,{defaultValue:null}),[workspaceList,setWorkspaceList]=(0,es.Z)(localStorageKeys.Zh,{defaultValue:[]});(0,react.useEffect)((()=>{if(workspaceId)if(workspaceId===constants.Ac&&null!==currentWorkspace)setCurrentWorkspace(null);else if(workspaceId!==currentWorkspace?.id){const foundWorkspace=workspaceList.find((x=>x.id===workspaceId));setCurrentWorkspace(foundWorkspace||null)}}),[workspaceId,workspaceList,currentWorkspace]);const handleSwitchWorkspace=(0,react.useCallback)((workspace=>{setCurrentWorkspace(workspace),onWorkspaceChanged?.(workspace?.id||constants.Ac)}),[onWorkspaceChanged]),handleAddWorkspace=(0,react.useCallback)((workspaceName=>{const newWorkspace={id:(0,v4.Z)(),name:workspaceName};setWorkspaceList((prev=>prev.find((p=>p.name===workspaceName))?[...prev]:[...prev,newWorkspace])),setCurrentWorkspace(newWorkspace),onWorkspaceChanged?.(newWorkspace.id)}),[onWorkspaceChanged]),handleRemoveWorkspace=(0,react.useCallback)((async id=>{setWorkspaceList((prev=>prev.filter((p=>p.id!==id))))}),[]),handleRenameWorkspace=(0,react.useCallback)(((id,newWorkspaceName)=>{setWorkspaceList((prev=>{const index=prev.findIndex((w=>w.id===id));return[...prev.slice(0,index-1),{id,name:newWorkspaceName},...prev.slice(index+1)]})),setCurrentWorkspace({id,name:newWorkspaceName})}),[]);return(0,jsx_runtime.jsx)(context.z.Provider,{value:{workspaceList,setWorkspaceList,currentWorkspace,switchWorkspace:handleSwitchWorkspace,addWorkspace:handleAddWorkspace,removeWorkspace:handleRemoveWorkspace,renameWorkspace:handleRenameWorkspace,...props},children:(0,jsx_runtime.jsx)(migrations_WorkspacesMigration,{children:children(currentWorkspace?.id||null)})})};WorkspacesContextProvider.displayName="WorkspacesContextProvider";const contexts_WorkspacesContext=WorkspacesContextProvider;try{WorkspacesContext.displayName="WorkspacesContext",WorkspacesContext.__docgenInfo={description:"",displayName:"WorkspacesContext",props:{workspaceId:{defaultValue:null,description:"",name:"workspaceId",required:!1,type:{name:"string"}},onWorkspaceChanged:{defaultValue:null,description:"",name:"onWorkspaceChanged",required:!1,type:{name:"((workspaceId: string) => void)"}},onApplicationInfoView:{defaultValue:null,description:"",name:"onApplicationInfoView",required:!1,type:{name:"(() => void)"}},onArchitectureView:{defaultValue:null,description:"",name:"onArchitectureView",required:!1,type:{name:"(() => void)"}},onDataflowView:{defaultValue:null,description:"",name:"onDataflowView",required:!1,type:{name:"(() => void)"}},onAssumptionListView:{defaultValue:null,description:"",name:"onAssumptionListView",required:!1,type:{name:"(() => void)"}},onMitigationListView:{defaultValue:null,description:"",name:"onMitigationListView",required:!1,type:{name:"(() => void)"}},onThreatListView:{defaultValue:null,description:"",name:"onThreatListView",required:!1,type:{name:"((filter?: ThreatStatementListFilter) => void)"}},onThreatEditorView:{defaultValue:null,description:"",name:"onThreatEditorView",required:!1,type:{name:"((threatId: string) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/contexts/WorkspacesContext/index.tsx#WorkspacesContext"]={docgenInfo:WorkspacesContext.__docgenInfo,name:"WorkspacesContext",path:"src/contexts/WorkspacesContext/index.tsx#WorkspacesContext"})}catch(__react_docgen_typescript_loader_error){}},"./src/contexts/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$C:()=>_WorkspacesContext_context__WEBPACK_IMPORTED_MODULE_19__.$,Lf:()=>_ContextAggregator__WEBPACK_IMPORTED_MODULE_25__.Z,_m:()=>_AssumptionLinksContext_context__WEBPACK_IMPORTED_MODULE_5__._,eu:()=>_MitigationLinksContext_context__WEBPACK_IMPORTED_MODULE_13__.e,nk:()=>_GlobalSetupContext_context__WEBPACK_IMPORTED_MODULE_11__.n});__webpack_require__("./src/contexts/ApplicationContext/index.tsx"),__webpack_require__("./src/contexts/ApplicationContext/context.ts"),__webpack_require__("./src/contexts/ArchitectureContext/index.tsx"),__webpack_require__("./src/contexts/ArchitectureContext/context.ts"),__webpack_require__("./src/contexts/AssumptionLinksContext/index.tsx");var _AssumptionLinksContext_context__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/contexts/AssumptionLinksContext/context.ts"),_GlobalSetupContext_context__WEBPACK_IMPORTED_MODULE_11__=(__webpack_require__("./src/contexts/AssumptionsContext/index.tsx"),__webpack_require__("./src/contexts/AssumptionsContext/context.ts"),__webpack_require__("./src/contexts/DataflowContext/index.tsx"),__webpack_require__("./src/contexts/DataflowContext/context.ts"),__webpack_require__("./src/contexts/GlobalSetupContext/index.tsx"),__webpack_require__("./src/contexts/GlobalSetupContext/context.ts")),_MitigationLinksContext_context__WEBPACK_IMPORTED_MODULE_13__=(__webpack_require__("./src/contexts/MitigationLinksContext/index.tsx"),__webpack_require__("./src/contexts/MitigationLinksContext/context.ts")),_WorkspacesContext_context__WEBPACK_IMPORTED_MODULE_19__=(__webpack_require__("./src/contexts/MitigationsContext/index.tsx"),__webpack_require__("./src/contexts/MitigationsContext/context.ts"),__webpack_require__("./src/contexts/ThreatsContext/index.tsx"),__webpack_require__("./src/contexts/ThreatsContext/context.ts"),__webpack_require__("./src/contexts/WorkspacesContext/index.tsx"),__webpack_require__("./src/contexts/WorkspacesContext/context.ts")),_ContextAggregator__WEBPACK_IMPORTED_MODULE_25__=(__webpack_require__("./src/contexts/ThreatPacksContext/index.tsx"),__webpack_require__("./src/contexts/ThreatPacksContext/context.ts"),__webpack_require__("./src/contexts/MitigationPacksContext/index.tsx"),__webpack_require__("./src/contexts/MitigationPacksContext/context.ts"),__webpack_require__("./src/contexts/WorkspaceContextAggregator/index.tsx"),__webpack_require__("./src/contexts/ContextAggregator/index.tsx"))},"./src/hooks/useExportImport/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>useExportImport});var react=__webpack_require__("../../node_modules/react/index.js"),contexts=__webpack_require__("./src/contexts/index.ts"),context=__webpack_require__("./src/contexts/ApplicationContext/context.ts"),ArchitectureContext_context=__webpack_require__("./src/contexts/ArchitectureContext/context.ts"),AssumptionLinksContext_context=__webpack_require__("./src/contexts/AssumptionLinksContext/context.ts"),AssumptionsContext_context=__webpack_require__("./src/contexts/AssumptionsContext/context.ts"),DataflowContext_context=__webpack_require__("./src/contexts/DataflowContext/context.ts"),GlobalSetupContext_context=__webpack_require__("./src/contexts/GlobalSetupContext/context.ts"),MitigationLinksContext_context=__webpack_require__("./src/contexts/MitigationLinksContext/context.ts"),MitigationsContext_context=__webpack_require__("./src/contexts/MitigationsContext/context.ts"),ThreatsContext_context=__webpack_require__("./src/contexts/ThreatsContext/context.ts");const utils_cleanupThreatData=threats=>threats.map((t=>{const nt={...t};return delete nt.displayedStatement,nt})),utils_downloadObjectAsJson=(exportObj,exportName)=>{var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(exportObj,null,2)),downloadAnchorNode=document.createElement("a");downloadAnchorNode.setAttribute("href",dataStr),downloadAnchorNode.setAttribute("download",exportName+".tc.json"),document.body.appendChild(downloadAnchorNode),downloadAnchorNode.click(),downloadAnchorNode.remove()};var getExportFileName=__webpack_require__("./src/utils/getExportFileName/index.ts"),renderThreatStatement=__webpack_require__("./src/utils/renderThreatStatement/index.ts");const utils_recalculateThreatData=threats=>threats.map((t=>{const{displayedStatement}=(0,renderThreatStatement.Z)(t);return{...t,displayedStatement}}));var sanitizeHtml=__webpack_require__("./src/utils/sanitizeHtml/index.ts"),customTypes=__webpack_require__("./src/customTypes/index.ts");const utils_validateData=data=>customTypes.DataExchangeFormatSchema.safeParse(data),useExportImport=()=>{const{composerMode}=(0,GlobalSetupContext_context.n)(),{currentWorkspace}=(0,contexts.$C)(),{applicationInfo,setApplicationInfo}=(0,context.M)(),{architectureInfo,setArchitectureInfo}=(0,ArchitectureContext_context.P)(),{dataflowInfo,setDataflowInfo}=(0,DataflowContext_context.y)(),{assumptionList,setAssumptionList}=(0,AssumptionsContext_context.H)(),{mitigationList,setMitigationList}=(0,MitigationsContext_context.I)(),{statementList,setStatementList}=(0,ThreatsContext_context.a)(),{assumptionLinkList,setAssumptionLinkList}=(0,AssumptionLinksContext_context._)(),{mitigationLinkList,setMitigationLinkList}=(0,MitigationLinksContext_context.e)(),getWorkspaceData=(0,react.useCallback)((()=>{const cleanedThreats=utils_cleanupThreatData(statementList);return"Full"===composerMode?{schema:1,applicationInfo,architecture:architectureInfo,dataflow:dataflowInfo,assumptions:assumptionList,mitigations:mitigationList,assumptionLinks:assumptionLinkList,mitigationLinks:mitigationLinkList,threats:cleanedThreats}:{schema:1,threats:cleanedThreats}}),[composerMode,currentWorkspace,applicationInfo,architectureInfo,dataflowInfo,assumptionList,mitigationList,assumptionLinkList,mitigationLinkList,statementList]),exportAll=(0,react.useCallback)((()=>{const exportFileName=(0,getExportFileName.Z)(composerMode,!1,currentWorkspace),exportObject=getWorkspaceData();utils_downloadObjectAsJson(exportObject,exportFileName)}),[getWorkspaceData,currentWorkspace,composerMode]),exportSelectedThreats=(0,react.useCallback)((selectedStatementList=>{const exportFileName=(0,getExportFileName.Z)(composerMode,!0,currentWorkspace);utils_downloadObjectAsJson({schema:1,workspace:currentWorkspace,threats:selectedStatementList},exportFileName)}),[currentWorkspace]),parseImportedData=(0,react.useCallback)((data=>{const parsedData=(0,sanitizeHtml.Z)(data);if(Array.isArray(parsedData))return{schema:-1,threats:data};const validatedData=utils_validateData(parsedData);if(!validatedData.success)throw new Error(validatedData.error.issues.map((i=>`${i.path}: ${i.message}`)).join("\n"));const importedData=validatedData.data;if(!parsedData.schema||1!==parsedData.schema)throw new Error("Unsupported Schema version");return importedData}),[]),importData=(0,react.useCallback)((data=>{const calculatedThreats=utils_recalculateThreatData(data.threats||[]);data.schema>0?(setApplicationInfo(data.applicationInfo||{}),setArchitectureInfo(data.architecture||{}),setDataflowInfo(data.dataflow||{}),setAssumptionList(data.assumptions||[]),setMitigationList(data.mitigations||[]),setStatementList(calculatedThreats),setAssumptionLinkList(data.assumptionLinks||[]),setMitigationLinkList(data.mitigationLinks||[])):setStatementList(data.threats||[])}),[setApplicationInfo,setArchitectureInfo,setDataflowInfo,setAssumptionList,setMitigationList,setStatementList,setAssumptionLinkList,setMitigationLinkList]);return{getWorkspaceData,exportAll,exportSelectedThreats,parseImportedData,importData}}},"./src/utils/getExportFileName/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>utils_getExportFileName});const utils_getExportFileName=(composerMode,filtered,currentWorkspace)=>`ThreatComposer_Workspace_${currentWorkspace?currentWorkspace.name.replace(" ","-"):"Default"}${"Full"!==composerMode?"_ThreatsOnly":""}${filtered?"_Filtered":""}`}}]);